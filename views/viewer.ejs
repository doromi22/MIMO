<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= comic.title %> - Viewer
    </title>
    <link rel="stylesheet" href="/styles/style.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js';
    </script>

    <meta name="pdf-url" content="<%= comic.pdf %>">
</head>

<body>
    <!-- Header and Navbar Container -->
    <div class="header-navbar-container">
        <!-- header -->
        <%- include ("header.ejs") %>

            <!-- navbar -->
            <%- include ("navbar.ejs") %>
    </div>
    <div class="viewer-container">
        <h1 style="color: white;">
            <%= comic.title %>
        </h1>
        <div class="page-container">
            <canvas id="page1" class="page"></canvas>
            <canvas id="page2" class="page"></canvas>
        </div>
        <div class="toggle-button" id="zurasubutton">
            <span style="color: rgb(184, 184, 184);">ページをずらす</span>
            <div id="toggleSwitch" class="toggle-switch"></div>
        </div>
        <button id="nextButton" class="nav-button next-button">
            <svg viewBox="0 0 24 24">
                <path d="M15 18l-6-6 6-6" stroke="gray" stroke-width="2" fill="none" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </button>
        <button id="prevButton" class="nav-button prev-button">
            <svg viewBox="0 0 24 24">
                <path d="M9 18l6-6-6-6" stroke="gray" stroke-width="2" fill="none" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </button>
        <button id="fullscreenToggle" class="fullscreen-toggle">
            <span>フルスクリーン</span>
            <div class="toggle-switch"></div>
        </button>
    </div>

    <% if (username) { %>
        <!-- 채팅 버튼 -->
        <button id="chat-toggle-button" class="chat-toggle-button">
            コメント
        </button>
        <% } %>

            <% if (username) { %>
                <!-- Chat UI 포함 -->
                <div id="chatContainer" class="chat-container" data-comic-id="<%= comic.id %>"
                    data-username="<%= username %>">
                    <div class="chat-header">
                        コメント
                        <button id="chat-close-button" class="close-button">&times;</button>
                    </div>
                    <div id="chatMessages" class="chat-messages">
                        <% chatMessages.forEach(chat=> { %>
                            <div class="chat-message">
                                <span class="chat-username" style="color: <%= chat.color %>">
                                    <%= chat.username %>
                                </span>: <%= chat.message %>
                                    <span class="chat-timestamp">
                                        <%= new Date(chat.timestamp).toLocaleString() %>
                                    </span>
                            </div>
                            <% }); %>
                    </div>
                    <form id="chatForm" class="chat-form">
                        <input type="text" id="chatInput" class="chat-input" placeholder="コメントを入力..." required />
                        <button type="submit" class="chat-send">送信</button>
                    </form>
                </div>
                <!-- Dark overlay -->
                <div id="chat-overlay" class="chat-overlay"></div>
                <% } %>

                    <div class="overlay" id="overlay"></div>
                    <script src="/scripts/scripts.js"></script>
</body>

</html>